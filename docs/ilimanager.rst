======================
ilimanager-Anleitung
======================

Überblick
=========

ilimanager ist ein in Java erstelltes Programm, um die Index-Dateien der
INTERLIS-Repositories automatisch zu pflegen.

Es bestehen u.a. folgende Funktionen:

- Erstellen einer ersten Version ilimodels.xml anhand von existierenden Modellen (ili-Dateien)
- Nachführen einer bestehenden ilimodels.xml Datei anhand einer neuen Version eines Modells
- Erstellen einer ersten Version ilidata.xml anhand von existierenden Daten (itf-/xtf/xml-Dateien)
- Nachführen einer bestehenden ilidata.xml Datei anhand einer neuen Version einer Daten-Datei
- Replizieren eines Repositories (z.B. für eine lokale Kopie)


Log-Meldungen
-------------
Die Log-Meldungen sollen dem Benutzer zeigen, was das Programm macht.
Am Anfang erscheinen Angaben zur Programm-Version.::
	
  Info: ilimanager-1.0.0
  ...
  Info: compile models...
  ...
  Info: ...clone done

Bei einem Fehler wird das am Ende des Programms vermerkt. Der eigentliche 
Fehler wird aber in der Regel schon früher ausgegeben.::
	
  Info: ilimanager-1.0.0
  ...
  Info: compile models...
  ...
  Error: failed to read ilimodels.xml
  ...
  Error: ...clone failed

Laufzeitanforderungen
---------------------

Das Programm setzt Java 1.8 voraus.

Lizenz
------

GNU Lesser General Public License

Funktionsweise
==============

In den folgenden Abschnitten wird die Funktionsweise anhand einzelner
Anwendungsfälle beispielhaft beschrieben. Die detaillierte Beschreibung
einzelner Funktionen ist im Kapitel „Referenz“ zu finden.

Es existiert aktuell kein GUI. 
Das Programm kann nur über die Kommandozeile benutzt werden.

Modell-Index (ilimodels.xml)-Funktionen
---------------------------------------

Fall 1.1
~~~~~~~~

Es werden alle Modell-Dateien (.ili) im gegebenen Verzeichnis ``folder`` analysiert
und dann ein neues ``newIliModels.xml`` mit den entsprechenden Metadaten 
erstellt. Falls die Datei ``newIliModels.xml``schon existiert wird der bestehende Inhalt 
überschrieben.

``java -jar ilimanager.jar --createIliModels --out newIliModels.xml --repos folder``

Fall 1.2
~~~~~~~~

Es werden alle Modell-Dateien (.ili) im gegebenen Verzeichnis ``folder`` analysiert
und dann ein bestehendes ``iliodels.xml`` mit den entsprechenden Metadaten 
ergänzt. Falls die Datei ``ilimodels.xml``noch nicht existiert, wird sie
neu erstellt.

``java -jar ilimanager.jar --updateIliModels --out newIliModels.xml --repos folder``


Daten-Index (ilidata.xml)-Funktionen
------------------------------------

Fall 2.1
~~~~~~~~

Es werden alle Dateien (ITF und XTF) im gegebenen Verzeichnis ``folder`` analysiert
und dann ein neues ``newIlidata.xml`` mit den entsprechenden Metadaten erstellt.

``java -jar ilimanager.jar --createIliData --out newIlidata.xml --repos folder``

Fall 2.2
~~~~~~~~

Es werden alle Dateien (ITF und XTF) gemäss Dateiliste ``files.txt`` 
im Repository ``http://models.geo.admin.ch`` analysiert
und dann ein neues ``newIlidata.xml`` mit den entsprechenden Metadaten erstellt.

``java -jar ilimanager.jar --createIliData --out newIlidata.xml --repos http://models.geo.admin.ch --srcfiles files.txt``

Fall 2.3
~~~~~~~~

Es wird die gegebene Datei ``newVersionOfData.xml`` (ITF oder XTF)
analysiert, und dann das ilidata.xml aus dem gegebenen Repository 
``http://models.geo.admin.ch`` mit einem neuen Eintrag für 
den Datensatz mit der ID ``datasetId`` aktualisiert. Die neue Version des 
ilidata.xml wird in die Datei ``updatedIlidata.xml`` geschrieben und muss
durch den Benutzer ins Repository übertragen werden.

``java -jar ilimanager.jar --updateIliData --out updatedIlidata.xml --repos http://models.geo.admin.ch --datasetId datasetId --data newVersionOfData.xml``

Repository-Funktionen
------------------------------------

Fall 3.1
~~~~~~~~

Es werden alle Modelle aus einem bestehenden Repository in ein neues Verzeichnis 
kopiert.

``java -jar ilimanager.jar java --cloneIliRepos --out newReposFolder --repos http://models.interlis.ch``

Referenz
========

In den folgenden Abschnitten werden einzelne Aspekte detailliert, aber
isoliert, beschrieben. Die Funktionsweise als Ganzes wird anhand
einzelner Anwendungsfälle beispielhaft im Kapitel „Funktionsweise“
(weiter oben) beschrieben.

Aufruf-Syntax
-------------

``java -jar ilimanager.jar [Options]``

Es existiert aktuell kein GUI. 
Das Programm kann nur über die Kommandozeile benutzt werden.

Der Rückgabewert ist wie folgt:

  - 0 Funktion ok, keine Fehler festgestellt
  - !0 Funktion nicht ok, Fehler festgestellt

Optionen:

+---------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Option                                      | Beschreibung                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
+=============================================+========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+
| ``--createIliModels``                       | Erstellt ein neues ilimodels.xml.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
+---------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ``--updateIliModels``                       | Ergänzt ein bestehendes ilimodels.xml. Falls das ilimodels.xml noch nicht existiert, wird es erstellt.                                                                                                                                                                                                                                                                                                                                                                                                                                 |
+---------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ``--createIliData``                         | Erstellt ein neues ilidata.xml.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
+---------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ``--updateIliData``                         | Ergänzt ein bestehendes ilidata.xml. Falls das ilidata.xml noch nicht existiert, wird es erstellt.                                                                                                                                                                                                                                                                                                                                                                                                                                     |
+---------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ``--cloneIliRepos``                         | Kopiert die Modelle aus einem bestehenden Modell Repository.                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
+---------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ``--modeldir path``                         | Dateipfade, die Modell-Dateien (ili-Dateien) enthalten. Mehrere Pfade können durch Semikolon ‚;‘ getrennt werden. Es sind auch URLs von Modell-Repositories möglich. Default ist                                                                                                                                                                                                                                                                                                                                                       |
|                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|                                             | %ITF\_DIR;http://models.interlis.ch/;%JAR\_DIR/ilimodels                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|                                             | %ITF\_DIR ist ein Platzhalter für das Verzeichnis mit der Transferdatei.                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|                                             | %JAR\_DIR ist ein Platzhalter für das Verzeichnis des ilivalidator Programms (ilivalidator.jar Datei).                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|                                             | Der erste Modellname (Hauptmodell), zu dem ili2db die ili-Datei sucht, ist nicht von der INTERLIS-Sprachversion abhängig. Es wird in folgender Reihenfolge nach einer ili-Datei gesucht: zuerst INTERLIS 2.3, dann 1.0 und zuletzt 2.2.                                                                                                                                                                                                                                                                                                |
|                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|                                             | Beim Auflösen eines IMPORTs wird die INTERLIS Sprachversion des Hauptmodells berücksichtigt, so dass also z.B. das Modell Units für ili2.2 oder ili2.3 unterschieden wird.                                                                                                                                                                                                                                                                                                                                                             |
+---------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ``--repos url``                             | Bestehendes Repository, das ausgelesen wird.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
+---------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ``--datasetId id``                          | Identifikator der Daten.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
+---------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ``--data filename``                         | Daten-Datei (XTF, ITF, XML).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
+---------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ``--out filename``                          | Datei oder Verzeichnis das erstellt oder überschrieben wird.                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
+---------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ``--srcfiles files.txt``                    | Liste mit relativen Dateipfaden (relativ zum gegebenen Folder/Repository). Ein Pfad pro Zeile.                                                                                                                                                                                                                                                                                                                                                                                                                                         |
+---------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ``--log filename``                          | Schreibt die log-Meldungen in eine Text-Datei.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
+---------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ``--plugins folder``                        | Verzeichnis mit JAR-Dateien, die Zusatzfunktionen enthalten. Die Zusatzfunktionen müssen das Java-Interface ``ch.interlis.iox_j.validator.InterlisFunction`` implementieren, und der Name der Java-Klasse muss mit ``IoxPlugin`` enden.                                                                                                                                                                                                                                                                                                |
+---------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ``--proxy host``                            | Proxy Server für den Zugriff auf Modell Repositories                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
+---------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ``--proxyPort port``                        | Proxy Port für den Zugriff auf Modell Repositories                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
+---------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ``--trace``                                 | Erzeugt zusätzliche Log-Meldungen (wichtig für Programm-Fehleranalysen)                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
+---------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ``--help``                                  | Zeigt einen kurzen Hilfetext an.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
+---------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ``--version``                               | Zeigt die Version des Programmes an.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
+---------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+


INTERLIS-Metaattribute
~~~~~~~~~~~~~~~~~~~~~~
Einzelne Funktionen nutzen Meta-Attribute. 
Metaattribute stehen unmittelbar vor dem Modellelement das sie betreffen und beginnen mit ``!!@``.
Falls der Wert (rechts von ```=```) aus mehreren durch Leerstellen getrennten Wörtern besteht, muss er mit Gänsefüsschen eingerahmt werden (```"..."```).

+------------------+---------------------------------------------+-----------------------------------------------------------------------------------+
| Modelelement     | Metaattribut                                | Beschreibung                                                                      |
+==================+=============================================+===================================================================================+
| ModelDef         | ::                                          |  Wert für das Attribut technicalContact im ilimodels.xml Eintrag des Modells.     |
|                  |                                             |                                                                                   |
|                  |  technicalContact                           |                                                                                   |
+------------------+---------------------------------------------+-----------------------------------------------------------------------------------+
| ModelDef         | ::                                          | GeoIV-Identifikator dieses Modells. Mehrere Einträge durch Komma getrennt.        |
|                  |                                             | Beispiel:                                                                         |
|                  |  IDGeoIV                                    |                                                                                   |
|                  |                                             | ::                                                                                |
|                  |                                             |                                                                                   |
|                  |                                             |   !!@ IDGeoIV="114.1, 114.3"                                                      |
|                  |                                             |                                                                                   |
|                  |                                             | Der Wert wird auch für das Attribut tags im ilimodels.xml Eintrag des Modells     |
|                  |                                             | verwendet.                                                                        |
+------------------+---------------------------------------------+-----------------------------------------------------------------------------------+
| ModelDef         | ::                                          |  Wert für das Attribut furtherInformation im ilimodels.xml Eintrag des Modells.   |
|                  |                                             |                                                                                   |
|                  |  furtherInformation                         |                                                                                   |
+------------------+---------------------------------------------+-----------------------------------------------------------------------------------+
| ModelDef         | ::                                          |  Wert für das Attribut tags im ilimodels.xml Eintrag des Modells.                 |
|                  |                                             |                                                                                   |
|                  |  tags                                       |                                                                                   |
+------------------+---------------------------------------------+-----------------------------------------------------------------------------------+
| ModelDef         | ::                                          |  Wert für das Attribut precursorVersion im ilimodels.xml Eintrag des Modells.     |
|                  |                                             |                                                                                   |
|                  |  precursorVersion                           |                                                                                   |
+------------------+---------------------------------------------+-----------------------------------------------------------------------------------+
| ModelDef         | ::                                          |  Wert für das Attribut furtherMetadata im ilimodels.xml Eintrag des Modells.      |
|                  |                                             |                                                                                   |
|                  |  furtherMetadata                            |                                                                                   |
+------------------+---------------------------------------------+-----------------------------------------------------------------------------------+
| ModelDef         | ::                                          |  Wert für das Attribut Original im ilimodels.xml Eintrag des Modells.             |
|                  |                                             |                                                                                   |
|                  |  Original                                   |                                                                                   |
+------------------+---------------------------------------------+-----------------------------------------------------------------------------------+
